{"ast":null,"code":"import _objectSpread from\"D:/neuralkissan/dashboard/dashboard/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useEffect,useState}from'react';import io from'socket.io-client';import{jsx as _jsx}from\"react/jsx-runtime\";const SocketContext=/*#__PURE__*/createContext();export const useSocket=()=>{const context=useContext(SocketContext);if(!context){throw new Error('useSocket must be used within a SocketProvider');}return context;};export const SocketProvider=_ref=>{let{children}=_ref;const[socket,setSocket]=useState(null);const[connected,setConnected]=useState(false);const[sensorData,setSensorData]=useState({});const[relayData,setRelayData]=useState({});useEffect(()=>{// Connect to Socket.IO server\nconst newSocket=io('http://localhost:5000',{transports:['websocket','polling']});newSocket.on('connect',()=>{console.log('Connected to server');setConnected(true);});newSocket.on('disconnect',()=>{console.log('Disconnected from server');setConnected(false);});newSocket.on('sensor_update',data=>{console.log('Sensor update received:',data);// Trigger re-fetch of sensor data in components\n});newSocket.on('relay_update',data=>{console.log('Relay update received:',data);setRelayData(prev=>_objectSpread(_objectSpread({},prev),{},{[data.unit_id]:data}));});newSocket.on('connected',data=>{console.log('Server message:',data);});setSocket(newSocket);return()=>{newSocket.close();};},[]);const joinUnit=unitId=>{if(socket){socket.emit('join_unit',{unit_id:unitId});}};const leaveUnit=unitId=>{if(socket){socket.emit('leave_unit',{unit_id:unitId});}};const value={socket,connected,sensorData,relayData,joinUnit,leaveUnit};return/*#__PURE__*/_jsx(SocketContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","io","jsx","_jsx","SocketContext","useSocket","context","Error","SocketProvider","_ref","children","socket","setSocket","connected","setConnected","sensorData","setSensorData","relayData","setRelayData","newSocket","transports","on","console","log","data","prev","_objectSpread","unit_id","close","joinUnit","unitId","emit","leaveUnit","value","Provider"],"sources":["D:/neuralkissan/dashboard/dashboard/frontend/src/contexts/SocketContext.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from 'react';\nimport io from 'socket.io-client';\n\nconst SocketContext = createContext();\n\nexport const useSocket = () => {\n  const context = useContext(SocketContext);\n  if (!context) {\n    throw new Error('useSocket must be used within a SocketProvider');\n  }\n  return context;\n};\n\nexport const SocketProvider = ({ children }) => {\n  const [socket, setSocket] = useState(null);\n  const [connected, setConnected] = useState(false);\n  const [sensorData, setSensorData] = useState({});\n  const [relayData, setRelayData] = useState({});\n\n  useEffect(() => {\n    // Connect to Socket.IO server\n    const newSocket = io('http://localhost:5000', {\n      transports: ['websocket', 'polling']\n    });\n\n    newSocket.on('connect', () => {\n      console.log('Connected to server');\n      setConnected(true);\n    });\n\n    newSocket.on('disconnect', () => {\n      console.log('Disconnected from server');\n      setConnected(false);\n    });\n\n    newSocket.on('sensor_update', (data) => {\n      console.log('Sensor update received:', data);\n      // Trigger re-fetch of sensor data in components\n    });\n\n    newSocket.on('relay_update', (data) => {\n      console.log('Relay update received:', data);\n      setRelayData(prev => ({\n        ...prev,\n        [data.unit_id]: data\n      }));\n    });\n\n    newSocket.on('connected', (data) => {\n      console.log('Server message:', data);\n    });\n\n    setSocket(newSocket);\n\n    return () => {\n      newSocket.close();\n    };\n  }, []);\n\n  const joinUnit = (unitId) => {\n    if (socket) {\n      socket.emit('join_unit', { unit_id: unitId });\n    }\n  };\n\n  const leaveUnit = (unitId) => {\n    if (socket) {\n      socket.emit('leave_unit', { unit_id: unitId });\n    }\n  };\n\n  const value = {\n    socket,\n    connected,\n    sensorData,\n    relayData,\n    joinUnit,\n    leaveUnit\n  };\n\n  return (\n    <SocketContext.Provider value={value}>\n      {children}\n    </SocketContext.Provider>\n  );\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}